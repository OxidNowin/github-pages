<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>WebApp Telegram</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
    <style>
        body {
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }
        a {
            color: var(--tg-theme-link-color, #0d6efd);
        }
        .btn-primary {
            background-color: var(--tg-theme-button-color, #007bff);
            color: var(--tg-theme-button-text-color, #ffffff);
        }
        .btn-danger {
            background-color: var(--tg-theme-destructive-text-color, #dc3545);
        }
        .form-control {
            background-color: var(--tg-theme-secondary-bg-color, #f8f9fa);
            color: var(--tg-theme-text-color, #000000);
        }
        .container {
            background-color: var(--tg-theme-section-bg-color, #f1f1f1);
            padding: 20px;
            border-radius: 10px;
        }
        .alert {
            background-color: var(--tg-theme-destructive-text-color, #dc3545);
            color: var(--tg-theme-button-text-color, #ffffff);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }
    </style>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            if (window.Telegram && Telegram.WebApp) {
                document.body.style.backgroundColor = Telegram.WebApp.themeParams.bg_color || "#ffffff";
                document.body.style.color = Telegram.WebApp.themeParams.text_color || "#000000";
            }
        });
    </script>
</head>
<body class="container mt-4">
    <h3 class="mb-3">Настройки поиска</h3>
    <form id="search-form">
        <div class="mb-3">
            <label for="days" class="form-label">Количество дней:</label>
            <input type="number" class="form-control" id="days" min="1" max="60" required>
        </div>
        
        <div class="mb-3">
            <label for="url" class="form-label">Ссылка:</label>
            <input type="url" class="form-control" id="url" pattern="https://www.avito.ru/.*" placeholder="https://www.avito.ru/" required>
        </div>
        
        <div class="mb-3">
            <label class="form-label">Ключевые слова:</label>
            <div id="keywords-container">
                <div class="input-group mb-2 keyword-entry">
                    <input type="text" class="form-control keyword" placeholder="Введите ключевое слово" required>
                    <input type="number" class="form-control pf-count" min="5" max="25" placeholder="Количество ПФ" required>
                    <button type="button" class="btn btn-danger remove-keyword">Удалить</button>
                </div>
            </div>
            <button type="button" class="btn btn-primary" id="add-keyword">Добавить ключевое слово</button>
        </div>
        
        <div class="alert" id="alert-message">Должно быть хотя бы одно ключевое слово!</div>
        
        <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="include-contacts">
            <label class="form-check-label" for="include-contacts">Включить контакты</label>
        </div>
        
        <button type="submit" class="btn btn-success">Сохранить</button>
    </form>
    
    <script>
        document.getElementById('add-keyword').addEventListener('click', function () {
            const container = document.getElementById('keywords-container');
            const entry = document.createElement('div');
            entry.className = 'input-group mb-2 keyword-entry';
            entry.innerHTML = `
                <input type="text" class="form-control keyword" placeholder="Введите ключевое слово" required>
                <input type="number" class="form-control pf-count" min="5" max="25" placeholder="Количество ПФ" required>
                <button type="button" class="btn btn-danger remove-keyword">Удалить</button>
            `;
            container.appendChild(entry);
        });

        document.getElementById('keywords-container').addEventListener('click', function (e) {
            if (e.target.classList.contains('remove-keyword')) {
                const keywords = document.querySelectorAll('.keyword-entry');
                if (keywords.length > 1) {
                    e.target.parentElement.remove();
                } else {
                    document.getElementById('alert-message').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('alert-message').style.display = 'none';
                    }, 3000);
                }
            }
        });

        document.getElementById('search-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const keywords = Array.from(document.querySelectorAll('.keyword')).map(input => input.value.trim());
            const pfCounts = Array.from(document.querySelectorAll('.pf-count')).map(input => input.value.trim());
            const data = {
                days: document.getElementById('days').value,
                url: document.getElementById('url').value,
                keywords: keywords.map((keyword, index) => ({ keyword, pf: pfCounts[index] })),
                includeContacts: document.getElementById('include-contacts').checked
            };
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.sendData(JSON.stringify(data));
                Telegram.WebApp.close();
            }
        });
    </script>
</body>
</html>
